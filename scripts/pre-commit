#!/bin/sh
# NossoDireito ‚Äî Pre-commit Hook (Quality Gate Local)
# Bloqueia commits se o Quality Gate falhar (score < 75 ou CRITICAL).
#
# Instala√ß√£o: copie para .git/hooks/pre-commit
#   cp scripts/pre-commit .git/hooks/pre-commit
#   chmod +x .git/hooks/pre-commit
#
# Para pular temporariamente: git commit --no-verify

echo ""
echo "üîé Quality Gate (pre-commit) ‚Äî verificando..."
echo ""

# Detectar Python
if command -v python3 > /dev/null 2>&1; then
    PYTHON=python3
elif command -v python > /dev/null 2>&1; then
    PYTHON=python
else
    echo "‚ö†Ô∏è  Python n√£o encontrado ‚Äî pulando Quality Gate."
    exit 0
fi

# Rodar Quality Gate em modo CI
$PYTHON codereview/codereview.py --ci --min-score 75

EXIT_CODE=$?

if [ $EXIT_CODE -ne 0 ]; then
    echo ""
    echo "üö´ COMMIT BLOQUEADO ‚Äî Quality Gate falhou."
    echo "   Corrija os problemas acima e tente novamente."
    echo "   Para pular: git commit --no-verify"
    echo ""
    exit 1
fi

echo ""
echo "‚úÖ Quality Gate OK ‚Äî commit permitido."
echo ""
exit 0
